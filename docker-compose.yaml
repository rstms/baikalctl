services:
  baikalctl:
    image: rstms/baikalctl:${BAIKALCTL_VERSION:-latest}
    build:
      context: docker
    restart: unless-stopped
    volumes:
      - ./certs:/home/baikalctl/certs
    environment:
      BAIKALCTL_USERNAME:
      BAIKALCTL_PASSWORD:
      BAIKALCTL_URL:
      BAIKALCTL_ADDRESS:
      BAIKALCTL_PORT:
      BAIKALCTL_CERT:
      BAIKALCTL_KEY:
      BAIKALCTL_LOG_LEVEL:
      BAIKALCTL_DEBUG:
      BAIKALCTL_VERBOSE:
      BAIKALCTL_PROFILE:
      BAIKALCTL_XVNC_VERBOSE:
      BAIKALCTL_PROFILE_CREATE_TIMEOUT:
    expose:
      - "8000"
    depends_on:
      - proxy
    hostname: baikalctl

  proxy:
    image: rstms/baikalctl_proxy:${BAIKALCTL_VERSION:-latest}
    build:
      context: proxy
    restart: unless-stopped
    volumes:
      - type: bind
        source: /etc/ssl
        target: /etc/nginx/ssl
        read_only: true
      - type: bind
        source: /var/www/acme
        target: /var/www/acme
        read_only: true
    ports:
      - "80:80"
      - "443:443"

networks:
  baikalctl-network:
    driver: bridge

