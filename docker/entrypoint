#!/bin/sh

set -ue 

cmd=
if [ $# -gt 0 ]; then
    cmd=$1
fi

serve() {
    echo "Version $(cat VERSION)"
    echo "Built $(cat /etc/build_time)"
    export DISPLAY=:1
    if [ -n "${BAIKALCTL_XVNC_VERBOSE:-}" ]; then
	echo vncserver logging enabled
	vncserver :1 &
    else
	echo vncserver logging disabled
	vncserver :1 >/dev/null 2>&1 &
    fi
    "$@"
    pkill vncserver
}


case $cmd in
    server) serve baikalctl;;
    docker-compose) cat docker-compose.yaml ;;
    show-config) baikalctl --show-config ;;
    dev) serve sleep inf;;
    *) "$@" ;;
esac
